<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insido AI â€” Golden Cosmic Intelligence</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#040207;
  --text:#f5f5f5;
  --user:#ffcc66;
  --muted:#c7b79c;
  --gold:#ffcc66;
  --red:#ff3c00;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Inter',sans-serif;
  background:radial-gradient(1200px 700px at 50% 100%,#140800,#040207);
  color:var(--text);
  overflow-x:hidden;
}

/* ================= BACKGROUND ================= */
canvas{position:fixed;inset:0;z-index:-10;pointer-events:none}
body::before{
  content:"";position:fixed;inset:0;z-index:-20;
  background:
    radial-gradient(900px 500px at 20% 15%,rgba(255,204,102,.18),transparent 60%),
    radial-gradient(800px 500px at 80% 20%,rgba(255,60,0,.14),transparent 65%),
    radial-gradient(700px 600px at 50% 90%,rgba(255,159,26,.12),transparent 65%);
}

/* ================= HEADER ================= */
header{
  position:fixed;top:0;left:0;right:0;
  padding:14px 28px;
  background:rgba(4,2,7,.35);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,204,102,.55);
  display:flex;justify-content:space-between;align-items:center;
  z-index:50;
}
.brand h1{font-weight:900;letter-spacing:1px}
.brand p{font-size:.7rem;color:var(--muted)}
.right {
  display: flex;
  align-items: center;
  gap: 10px;
}
#online {
  color: var(--text);
  font-weight: 600;
  font-size: 0.9rem;
}
.orb{
  width:14px;height:14px;border-radius:50%;
  background:radial-gradient(circle,var(--gold),var(--red));
  box-shadow:0 0 18px var(--gold);
  animation:pulse 2.5s infinite ease-in-out;
}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.4)}}

/* ================= HERO ================= */
.hero{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  text-align:center;padding:0 8%;
}
.hero h2{font-size:4.2rem;font-weight:900}
.hero h2 span{
  background:linear-gradient(90deg,#fff,var(--gold),var(--red));
  -webkit-background-clip:text;color:transparent
}
.hero p{color:var(--muted);font-size:1.2rem;margin-top:24px}
.scroll-btn{
  margin-top:48px;padding:16px 46px;border-radius:40px;
  font-weight:900;cursor:pointer;border:none;
  background:linear-gradient(90deg,var(--gold),var(--red));
  color:#120500;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.scroll-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px var(--gold);
}
.scroll-btn:active {
  animation: fire 0.5s;
}
@keyframes fire {
  0% { border: 2px solid var(--gold); }
  50% { border: 2px solid var(--red); }
  100% { border: 2px solid var(--gold); }
}

/* ================= CORE ================= */
.wrapper{
  min-height:100vh;
  display:flex;align-items:center;justify-content:center;
  padding:120px 6% 120px;
}
.core{
  width:100%;max-width:960px;
  padding:64px;border-radius:46px;
  background:rgba(255,204,102,.06);
  border:1px solid rgba(255,204,102,.35);
  backdrop-filter:blur(6px);
  text-align:center;
  position:relative;
}

/* TEXT BOX */
.core-box{
  width:100%;
  min-height:120px;
  padding:24px 28px;
  border-radius:34px;
  background:rgba(0,0,0,.38);
  border:1px solid rgba(255,204,102,.35);
  color:var(--text);
  font-size:1.05rem;
  resize:none;
  overflow-y: auto;
  transition: min-height 0.45s ease, box-shadow 0.45s ease, border 0.45s ease;
}
.core-box::placeholder {
  font-weight: bold;
}
::-webkit-scrollbar {
  display: none;
}

/* INSTANT EXPAND */
.core-box.expanded{
  min-height:260px; /* instant jump */
  border:2px solid var(--gold);
  box-shadow:0 0 40px rgba(255,204,102,.6);
}

/* BUTTON */
.ask-btn{
  margin-top:34px;padding:18px 54px;border-radius:40px;
  font-weight:900;cursor:pointer;border:none;
  background:linear-gradient(90deg,var(--gold),var(--red));
  color:#120500;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.ask-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px var(--gold);
}
.ask-btn:active {
  animation: fire 0.5s;
}

/* THINKING OVERLAY */
.thinking{
  position:absolute;inset:0;
  display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(6px);
  border-radius:46px;
  color:var(--gold);
  font-weight:800;
}

/* EMPTY MESSAGE */
.hint{
  margin-top:18px;
  color:var(--gold);
  font-weight:600;
  display:none;
}

/* LOCK */
.core.locked{pointer-events:none;opacity:.75}

/* ================= FOOTER ================= */
footer{
  position:fixed;bottom:0;left:0;right:0;
  padding:12px 28px;
  background:rgba(4,2,7,.35);
  backdrop-filter:blur(12px);
  border-top:1px solid rgba(255,204,102,.55);
  display:flex;justify-content:space-between;
  color:var(--muted);font-size:.75rem;
}
</style>
</head>

<body>

<canvas id="bg"></canvas>

<header>
  <div class="brand">
    <h1>INSIDO</h1>
    <p>Insido v1 Â· by Darshit Tank</p>
  </div>
  <div class="right">
    <div id="online">Online: 0</div>
    <div class="orb"></div>
  </div>
</header>

<section class="hero">
  <div>
    <h2>Cosmic <span>Intelligence</span></h2>
    <p>Ask. Explore. Reason.</p>
    <button class="scroll-btn" onclick="document.getElementById('ai').scrollIntoView({behavior:'smooth'})">
      GO TO INSIDO CORE â†“
    </button>
  </div>
</section>

<section id="ai" class="wrapper">
  <div class="core" id="core">
    <textarea id="box" class="core-box" placeholder="Ask Insido anythingâ€¦"></textarea>
    <div class="thinking" id="thinking">Insido is thinkingâ€¦</div>
    <div class="hint" id="hint">âœ¨ Please enter a question to begin âœ¨</div>
    <button id="ask" class="ask-btn">ASK INSIDO</button>
  </div>
</section>

<footer>
  <span>Â© 2026 Insido AI</span>
  <span>Contact: darshittaank@myyahoo.com</span>
</footer>

<script>
/* ===== BACKGROUND ===== */
const c=document.getElementById('bg'),ctx=c.getContext('2d');
let w,h;function rs(){w=c.width=innerWidth;h=c.height=innerHeight}
rs();addEventListener('resize',rs);

const stars=[...Array(220)].map(()=>({x:Math.random()*w,y:Math.random()*h,v:Math.random()*0.5+.2}));
const meteors=[...Array(6)].map(()=>({x:Math.random()*w,y:Math.random()*-h,l:Math.random()*140+80,v:Math.random()*7+5}));

function animate(){
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#fff';
  stars.forEach(s=>{s.y+=s.v;if(s.y>h){s.y=0;s.x=Math.random()*w}ctx.fillRect(s.x,s.y,1.2,1.2)});
  ctx.strokeStyle='rgba(255,204,102,.65)';
  meteors.forEach(m=>{
    m.x+=m.v;m.y+=m.v;
    if(m.y>h){m.x=Math.random()*w;m.y=Math.random()*-h}
    ctx.beginPath();ctx.moveTo(m.x,m.y);ctx.lineTo(m.x-m.l,m.y-m.l);ctx.stroke();
  });
  requestAnimationFrame(animate);
}
animate();

/* ===== AI LOGIC ===== */
let busy=false;
let lastUser = '';
let lastReply = '';
let conversationHistory = "";
let lastSafeValue = "";
let isReplyShown = false;
const box=document.getElementById("box");
const ask=document.getElementById("ask");
const thinking=document.getElementById("thinking");
const core=document.getElementById("core");
const hint=document.getElementById("hint");

// ðŸ”’ LOCK OLD CONVERSATION
box.addEventListener("input", () => {
  // If user tries to modify old chat, restore it
  if (!box.value.startsWith(conversationHistory)) {
    box.value = lastSafeValue;
  }
});


box.addEventListener("focus",()=>box.classList.add("expanded"));

function updateOnline() {
  fetch('/online')
    .then(response => response.json())
    .then(data => {
      document.getElementById('online').innerText = `Online: ${data.count}`;
    })
    .catch(() => {});
}

function updateOnline() {
  fetch('/online', { cache: 'no-store' })
    .then(res => {
      if (!res.ok) throw new Error("Network error");
      return res.json();
    })
    .then(data => {
      document.getElementById('online').innerText = `Online: ${data.count}`;
    })
    .catch(err => {
      console.error("Counter error:", err);
    });
}

updateOnline();
setInterval(updateOnline, 5000);


ask.onclick=async()=>{
  if(busy) return;

  const user=box.value.trim();

  if(!user || (isReplyShown && box.value.trim() === `You:\n${lastUser}\n\nInsido:\n${lastReply}`)){
    hint.style.display="block";
    setTimeout(()=>hint.style.display="none",2000);
    return;
  }

  busy=true;
  hint.style.display="none";
  box.classList.add("expanded");
  box.disabled=true;
  ask.style.display="none";
  thinking.style.display="flex";
  core.classList.add("locked");

  try{
    const res=await fetch("/chat",{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:user})
    });

    let reply=(await res.json()).reply||"â€” Insido AI";
    reply=reply.replace(/thinking[\s\S]*/gi,"").trim();

    thinking.style.display="none"; // hide BEFORE showing answer
    lastUser = user;
    lastReply = reply;
    isReplyShown = true;
    conversationHistory += `You:\n${user}\n\nInsido:\n${reply}\n\n`;
box.value = conversationHistory;
lastSafeValue = conversationHistory;


  }catch{
    thinking.style.display="none";
    box.value="Insido encountered an error.";
  }

  box.disabled=false;
  ask.style.display="inline-block";
  core.classList.remove("locked");
  busy=false;
};
</script>

</body>
</html>